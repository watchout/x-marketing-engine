# X API レート制限 タイムマトリクス

## 概要

X API Freeプランには厳しい制限があります。効率的に使用するためのスケジュール設計です。

## 月間制限（最重要）

| 操作 | 月間上限 | 現在の使用量目安 |
|------|---------|----------------|
| 投稿作成 | 1,500回 | 5投稿/日 × 30日 = 150回 ✅ |
| ツイート読み取り | **100回** | メトリクス収集で超過リスク ⚠️ |

## 15分間レート制限（実測値）

| エンドポイント | App Context (Bearer) | 備考 |
|---------------|---------------------|------|
| GET /2/users/me | 75回 | アカウント情報 |
| GET /2/users/by/username | 300回 | ユーザー検索 |
| GET /2/users/:id/tweets | 300回 | タイムライン |
| **GET /2/tweets** | **1回** | ⚠️ 極めて制限的！最大100件/回 |

## 日次スケジュール

```
┌─────────┬────────────────────────────────────────────────────┐
│  時刻   │  処理                                              │
├─────────┼────────────────────────────────────────────────────┤
│ 07:00   │ 📊 メトリクス収集（週1-2回に制限）                 │
│         │ 📈 アカウント統計取得（v2.me）                     │
│         │ 🌐 海外リサーチ（Grok - X API不使用）              │
│         │ 📝 投稿生成（LLM - X API不使用）                   │
├─────────┼────────────────────────────────────────────────────┤
│ 08:00   │ 🐦 朝投稿（v2.tweet）                              │
├─────────┼────────────────────────────────────────────────────┤
│ 10:00   │ 🐦 午前投稿（v2.tweet）                            │
├─────────┼────────────────────────────────────────────────────┤
│ 12:00   │ 🐦 昼投稿（v2.tweet）                              │
├─────────┼────────────────────────────────────────────────────┤
│ 18:00   │ 🐦 夕方投稿（v2.tweet）                            │
│         │ 💬 インフルエンサー監視（週1回に制限）             │
├─────────┼────────────────────────────────────────────────────┤
│ 21:00   │ 🐦 夜投稿（v2.tweet）                              │
└─────────┴────────────────────────────────────────────────────┘
```

## API呼び出し最適化

### 1. メトリクス収集の最適化

**問題**: 月100回の読み取り制限 vs 5投稿/日 × 30日 = 150投稿

**対策**:
- 週1-2回のバッチ収集に変更
- 直近7日間の投稿のみ収集
- 1回のAPI呼び出しで複数ツイートを取得（バルクAPI使用）

```typescript
// 単一取得（非効率）
client.v2.singleTweet(id1)  // 1回
client.v2.singleTweet(id2)  // 1回
client.v2.singleTweet(id3)  // 1回

// バルク取得（効率的）
client.v2.tweets([id1, id2, id3, ...], { ... })  // 1回で最大100件
```

### 2. インフルエンサー監視の最適化

**対策**:
- 日次から週次に変更
- 監視対象を5アカウントに絞る
- バッチでユーザーIDを取得

### 3. アカウント統計の最適化

**対策**:
- 15分に75回まで可能なので、現状維持でOK

## 推奨週間スケジュール

| 曜日 | 投稿 | メトリクス | インフルエンサー監視 |
|------|------|-----------|---------------------|
| 月 | 5回 | ✅ 週次収集 | - |
| 火 | 5回 | - | - |
| 水 | 5回 | - | - |
| 木 | 5回 | ✅ 週次収集 | ✅ 週次監視 |
| 金 | 5回 | - | - |
| 土 | 5回 | - | - |
| 日 | 5回 | - | - |

## API使用量の月間見積もり

| 操作 | 回数/週 | 月間使用量 | 制限 | 余裕 |
|------|--------|-----------|------|------|
| 投稿作成 | 35 | 140 | 1,500 | ✅ 十分 |
| ツイート読み取り | 30 | **120** | 100 | ⚠️ 超過 |
| ユーザー検索 | 5 | 20 | ∞* | ✅ 十分 |
| タイムライン取得 | 5 | 20 | ∞* | ✅ 十分 |
| アカウント統計 | 7 | 28 | ∞* | ✅ 十分 |

*15分間レート制限のみ

## 結論

**月100回の読み取り制限が最大のボトルネック**

### 対策案

1. **バルクAPI使用**: 1回のAPI呼び出しで最大100ツイートのメトリクスを取得
2. **収集頻度削減**: 週1回のバッチ収集に変更
3. **優先度付け**: 直近の投稿のみメトリクス収集
4. **Basicプラン検討**: 月$100で10,000読み取り/月に拡張可能
